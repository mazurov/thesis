\section{\texorpdfstring{$\Upsilon$}{Y} signal extraction}
\label{sec:upsilon}

%% ============================================================================
\subsection{Selection}
\label{sec:ups:selelection}
\subsubsection{Pre-selection}
\label{sec:upsilon:selelection:preselection}
The pre-selected event candidates were taken from datasets dedicated to
quarkonia studies in \lhcb. The selection starts by forming candidates from
pairs of oppositely-charged tracks identified as muons and originated from a
common vertex. Good track quality is ensured by requiring a $\chisq$ per number
of degrees of freedom ($\chisq/\rm{ndf}$) to be less then 4 for the track fit
and primary vertex probability greater than 0.5 \%. The muons were required to
have a transverse momentum higher than 1 \gevc. To suppress duplicate tracks a
cut on the Kullback-Leibler~\cite{Needham:1082460} (KL) distance was used: only
tracks with symmetrized KL distance less than 5000 were selected\footnote{The
KL distance measures the difference between PDFs that describe track
parameters. If the distance is small then two tracks are likely to be
clones.}.The primary vertex of the dimuon candidate is required to be within the 
luminous region, defined as $|z_{PV}| < 0.5 m$ and $x_{PV}^2 + y_{PV}^2 < 100
mm^2$, where $z$ is the beam axis, $x$ and $y$ are the horizontal and vertical directions 
in the plane perpendicular to the beam axis.  
%============================================================================
\subsubsection{Trigger}
\label{sec:upsilon:selection:trigger}

For $\Upsilon$ studies the event candidates should pass three
trigger levels, with the specific requirement that the muon pair fires the 
trigger ('Trigger-on-Signal', or 'TOS' requirement). The first level ('L0DiMuon') requires
the product of the $p_T$ of the two muon candidates to be greater than 1.68$\gev^2/c^2$, and
a loose requirement on the number of hits in the SPD for the whole event (less than 9000 hits).

The second level is the HLT1 trigger, where the event candidates were required to
pass the Hlt1DiMuonHighMass line.
This line triggers events with  two well reconstructed tracks  which have hits
in the muon system  that have a transverse momentum greater than 500\mevc,  
a momentum greater than 6\gevc, which are originating from a common vertex with
an invariant mass greater than 2.7\gevcc.

At the last HLT2 level the event needs to be accepted by the HLT2DiMuonB line.
This line confirms the HLT1 decision by using better reconstructed tracks, 
and requires the invariant mass of the dimuon pair to be larger than 4.7\gevcc.

%% ============================================================================
\subsubsection{Selection criteria specific for this study}
\label{sec:upsilon:selection:study}

To improve the muon identification purity two additional criteria are used. The
first one is applied on the difference in logarithm of the likelihood of the
muon and hadron hypotheses~\cite{Powell} provided by the muon detection system.
This difference ($\Delta\log\lum^{\mu-\Ph}$) should be greater than 0. The
second requires a cut on the muon probability value obtained from a Neural
Network algorithm (ProbNN). This algorithm takes into account various
information such as the RICH particle identification criteria, the muon
reconstruction quality and its compatibility with a minimum ionising particle in the
calorimeters. In this study a cut on  ProbNN value
greater than $0.5$ is applied. 

The criteria for  $\Upsilon$ selection are summarized in
Table~\ref{tab:upsilon:selection:study:summary}.

\input{tables/upsilon/selection_study_summary}

%% ============================================================================
\subsection{Fit model}
\label{sec:upsilon:fit}
All  fits in this study are performed with the RooFit package\cite{roofit}.
To determine the yields of $\Upsilon$ mesons, an unbinned maximum likelihood
fit to the dimuon mass distribution has been performed. The signals have been
modeled with the sum of three double-sided CrystalBall (DSCB) functions and the
combinatorial background by an exponential function with floating $\tau$
parameter. Each DSCB function corresponds to the \Y1S, \Y2S and \Y3S
signals and can be written in the following form:

\begin{equation}
DSCB(x) = N \times
\begin{cases}
\frac{1}{\sqrt{2\pi\sigma}}{(\frac{n_L}{|\alpha_L|})}^{n_L}\exp(-\frac{|\alpha_L|^2}{2}){(\frac{n_L}{|\alpha_L|}-|\alpha_L|-\frac{x-\mu}{\sigma})}^{-n_L} & \text{, if $\frac{x-\mu}{\sigma} < -\alpha_L$}\\
\frac{1}{\sqrt{2\pi\sigma}}{(\frac{n_R}{|\alpha_R|})}^{n_R}\exp(-\frac{|\alpha_R|^2}{2}){(\frac{n_R}{|\alpha_R|}-|\alpha_R|+\frac{x-\mu}{\sigma})}^{-n_R} & \text{, if $\frac{x-\mu}{\sigma} > \alpha_R$}\\
\frac{1}{\sqrt{2\pi\sigma}}\exp(-\frac{{(x-\mu)}^2}{2\sigma^2}) & \text{, otherwise}
\end{cases}
\label{eq:dcb}
\end{equation}

The double-sided CrystalBall is similar to a gaussian
distribution, but has asymmetric tails. This function has seven parameters:
the number of events N, $\mu$, $\sigma$, $\alpha_L$, $n_L$, $\alpha_R$, $n_R$ where parameters $\mu$
and $\sigma$ have the same meaning as for gaussian. Parameters $\alpha_L
(\alpha_R)$ and $n_L (n_R)$ describe the left (right) tail behavior:
$\alpha_{L,R}$ controls the tail start and $n_{L,R}$ corresponds to the
decreasing power of the tail. 

%% %CONCEZIO WHATS THIS? All five parameters $N$, $\alpha_L$, $n_L$,
%% %                                                 $\alpha_R$ and $n_R$ contribute to the amplitude.

% The mass of \Y1S is allowed to vary. Mass of \Y2S (\Y3S) are defined as sum of
% \Y1S mass and the value of corresponding difference between mass of
% \Y2S (\Y3S) and \Y1S. These two mass differences, named $\Delta m_{\Y2S}$ and
% $\Delta m_{\Y3S}$, are fixed in the fit to PDG~\cite{PDG2012} values 563 \mevcc
% and 895 \mevcc correspondingly.

% The width of the Crystal Ball function describing the \Y1S meson is allowed to
% vary, while the width of \Y2S and \Y3S mesons are constrained to the value of
% the width of the \Y1S signal, scaled by the ratio of the masses of \Y2S and \Y3S
% to the \Y1S meson.

In all DSCB functions, the  $\alpha_{L,R}$ and $n_{L,R}$ parameters are fixed to the values extracted
from fits to the simulated $\Upsilon \to \mumu$ decays. The $\alpha_L$ and
$\alpha_R$ values are fixed to 1.6, while values of $n_L$  and $n_R$ are fixed
to 2 and 11 respectively. All other parameters are allowed to vary in the fit model.

%% ============================================================================
\subsection{Fit results}
\label{sec:upsilon:result}

Figure~\ref{fig:upsilon:result:nominal} presents the result of the fit 
described in the previous section. The fit was performed in the dimuon
transverse momentum interval $ 6 < p_T^{\mumu} < 40 \gevc$.
Table~\ref{tab:upsilon:result:nominal} shows the obtained parameters values. 

\input{pics/upsilon/result_nominal}
\input{tables/upsilon/result_nominal}

\input{pics/upsilon/mean_sigma}

% \Cref{fig:upsilon:result:mean_sigma}(a) shows the fitted \Y1S mass is about
% 5 \mevcc lower than PDG value $9460.30 \pm  0.26$ \mevcc.

% \input{upsilon/result/pics/mass}


\Cref{fig:upsilon:result:mean_sigma} shows  the fitted $\Upsilon(1S)$
mass differs by 3 $\pm$ 2 \mevcc from the PDG value $9460.30 \pm  0.26$ \mevcc and
varies as a function of transverse momentum, as also observed in other
studies~\cite{Aaij:2013yaa}. A systematic uncertainty is assigned due to this
effect. To obtain the final numbers for $\Upsilon$ yields the fit was repeated
independently for each $p_T^{\mumu}$ bin with the \OneS mass fixed to
$9.456 \gevcc$ that was measured in the fit of the joined 2011 and 2012 datasets.

Figure~\ref{fig:upsilon:result:yields} shows the number of signal events as
function of dimuon transverse momentum. Table~\ref{tab:upsilon:result:fits} in
Appendix summarizes the obtained results. Figure
\ref{fig:upsilon:result:yields_scaled} shows the $\Upsilon(nS)$ yields as a
function of transverse momentum, normalized by bin size and luminosity. The
small difference between 7 and 8 \tev data is due to the production cross
section, which is expected to rise by about 10\% for the latter case.


\input{pics/upsilon/result_yields}

